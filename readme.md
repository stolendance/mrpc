# readme

> 我的理解: 单机 硬件不够 ,并发满足不了, 还容易挂
>
> 所以扩展成集群, 集群每个服务器上都部署一套完整的系统, 硬件够了,也不容易挂了
>
> 但有点浪费,有些模块不需要部署多台上, 太费资源了 , 所以分布式 , 把系统拆分成模块 放到每台服务器上  需要高并发的模块就多放几台 容易挂的也多放几台  资源需求就蛮少
>
> 





## 集群和分布式

集群:每一台服务器独立运行一个工程的所有模块

分布式:一个工程拆分了很多模块,每一个模块独立部署运行在一个服务器主机上,所有服务器协同工作共同提供服务,每一台服务器称作分布式的一个节点,根据节点的并发要求,对一个节点可以再做节点模块集群部署



## 单机聊天服务器



<img src="/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504110022486.png" alt="image-20230504110022486" style="zoom:50%;" />

1. 受限于硬件资源,聊天服务器所能承受的用户的并发量
2. 挂了就完了

3. 一个bug  整个代码全部重新编译

4. 系统中,有些模块属于cpu密集型的,有些模块属于io密集型的,造成各个对于硬件需求是不一样的

## 集群聊天服务器

![image-20230504110054259](/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504110054259.png)

只解决了硬件资源, 挂了就完了这俩问题

代码需要费大力重新部署,每个模块对硬件的需求是不同的(只是水平扩展硬件) 这俩都没解决

比如后台管理模块这个模块,根本不需要高并发,没必要放到每个服务器上

> 管理员访问还需要通过负载均衡模块, 分配到服务器上,这不是 没必要嘛

## 分布式聊天服务器

把系统拆分成模块 放到每台服务器上  需要高并发的模块就多放几台 容易挂的也多放几台  资源需求就蛮少



![image-20230504110857220](/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504110857220.png)

比如消息管理 可以放置到 多个服务器上

硬件资源 解决

挂了 解决。 挂了 多放几台呗   

bug重新部署 解决

io cpu需要不同 解决

根据分布式节点并发需求可以再扩展

### 从集群式 到 分布式聊天服务器 看来只有好处 ,但代价是什么?

1. 大系统的软件模块该怎么划分

    各模块可能会实现大量重复的代码,需要架构的比较好

2. 各个模块之间该怎么访问?

   各个模块都运行在不同的进程里. 

   docker虚拟化环境中

![image-20230504142329365](/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504142329365.png)

### rpc 的 通信原理 remote procedure call 当成分布式通信就行

机器a如何 调用 机器 b 的函数 

![image-20230504144250652](/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504144250652.png)

一个函数 发现是rpc函数 ,服务配置中心查到这个服务在哪个机器上 ,  把函数名与参数序列化发送给该机器  , 机器反序列化 执行该函数。把结果序列化 传给 原机器。 原机器序列化 得到结果

#### 将要实现 的 分布式mrpc 负责的部分

![image-20230504144658261](/Users/huangchenghao/CLionProjects/mrpc/assets/image-20230504144658261.png)

黄色部分:protobuf 序列化 

绿色部分:zookeeper服务器配置中心 muduo网络库

### protobuf>=json 好处?

1. protobuf是二进制存储的;xml和json都是文本存储的
2. protobuf不需要存储额外的信息,json是怎么存储数据的呢 json是keyvalue 需要key